;
;
; love in time of laser raptors
; awsm 2017
;
;

!cpu 6502
!to "build/love-in-time-of-laser-raptors.prg",cbm

;
; symbols
;

	SCRRAM = $0400
	COLRAM = $d800
	tmp_akku = $a6
	tmp_xreg = $a7
	tmp_yreg = $a8


;
; BASIC start line
;

	*=$801
	!byte $b,$08,$ef,$0,$9e,$32,$30,$36,$31,$0,$0,$0

;
; set border and background colors
;

	lda	#0
	sta	$d020
	sta	$d021
	ldx #0
	jsr clear

;
; show intro text
;

	ldx #0

show_title_text:

	lda title_text,x
	sta SCRRAM+14*40+5,x
	inx
	cpx #29
	bne show_title_text


	ldy #50
-
	jsr colwash
	dey
	bne -


;
; draw the chars into screenram
; and initialize all colors to black
;

	ldx	#0
	ldy	#250

screenram:

	; screen data
	lda	chars_data,x
	sta	SCRRAM,x
	lda	chars_data+250,x
	sta	SCRRAM+250,x
	lda	chars_data+500,x
	sta	SCRRAM+500,x
	lda	chars_data+750,x
	sta	SCRRAM+750,x

	; color data
	lda	#0
	sta	COLRAM,x
	sta	COLRAM+250,x	
	sta	COLRAM+500,x
	sta	COLRAM+750,x
	inx
	dey
	bne	screenram


;
; split line animation right to left
;

	ldx	#39
	ldy	#40


full_color_2
	; color data

	jsr wait

	lda color_data+1*40,x
	sta	COLRAM+1*40,x
	lda color_data+3*40,x
	sta	COLRAM+3*40,x	
	lda color_data+5*40,x
	sta	COLRAM+5*40,x
	lda color_data+7*40,x
	sta	COLRAM+7*40,x
	lda color_data+9*40,x
	sta	COLRAM+9*40,x
	lda color_data+11*40,x
	sta	COLRAM+11*40,x	
	lda color_data+13*40,x
	sta	COLRAM+13*40,x
	lda color_data+15*40,x
	sta	COLRAM+15*40,x	
	lda color_data+17*40,x
	sta	COLRAM+17*40,x
	lda color_data+19*40,x
	sta	COLRAM+19*40,x
	lda color_data+21*40,x
	sta	COLRAM+21*40,x
	lda color_data+23*40,x
	sta	COLRAM+23*40,x	

	dex
	dey
	bne	full_color_2

;
; split line animation left to right
;

	ldx	#0
	ldy	#40


full_color
	; color data

	jsr wait

	lda color_data,x
	sta	COLRAM+0*40,x
	lda color_data+2*40,x
	sta	COLRAM+2*40,x	
	lda color_data+4*40,x
	sta	COLRAM+4*40,x
	lda color_data+6*40,x
	sta	COLRAM+6*40,x
	lda color_data+8*40,x
	sta	COLRAM+8*40,x
	lda color_data+10*40,x
	sta	COLRAM+10*40,x	
	lda color_data+12*40,x
	sta	COLRAM+12*40,x
	lda color_data+14*40,x
	sta	COLRAM+14*40,x	
	lda color_data+16*40,x
	sta	COLRAM+16*40,x
	lda color_data+18*40,x
	sta	COLRAM+18*40,x
	lda color_data+20*40,x
	sta	COLRAM+20*40,x
	lda color_data+22*40,x
	sta	COLRAM+22*40,x	
	lda color_data+24*40,x
	sta	COLRAM+24*40,x	

	inx
	dey
	bne	full_color


-
	jmp -


;
; wait
;

wait:  
	stx tmp_xreg
	sty tmp_yreg
	sei
	lda #$fb
check:
	cmp $d012
	bne check
	ldy waittime
l0:
	ldx #$30
l1:
	dex
	cpx #$0          
	bne l1
	dey
	cpy #$0
	bne l0
	ldx tmp_xreg
	ldy tmp_yreg
  rts

;
; clear the screen
;

clear:
  lda #$20     ; #$20 is the spacebar Screen Code
	sta $0400,x  ; fill four areas with 256 spacebar characters
	sta $0500,x 
	sta $0600,x 
	sta $06e8,x
	lda #0
	sta $d800,x  
	sta $d900,x
	sta $da00,x
	sta $dae8,x
	inx           ; increment X
	bne clear     ; did X turn to zero yet?
	             ; if not, continue with the loop
	rts           ; return from this subroutine

;
; color washer routine
;

colwash:
	stx tmp_xreg
	lda text_colorcycle+49      ; load the current first color from table
	sta text_colorcycle+$00      ; store in in last position of table to reset the cycle
	ldx #50           ; init X with zero

cycle1:

	lda text_colorcycle-1,x      ; Start cycle by fetching next color in the table...
	sta text_colorcycle,x        ; ...and store it in the current active position.      
	sta COLRAM+14*40,x
	dex                ; increment X-Register
	bne cycle1         ; if no, continue
	jsr wait
	jsr wait
	jsr wait
	lda tmp_xreg
	rts

chars_data:
; Character data
	!byte 96,96,46,96,96,96,96,96,96,96,96,46,96,96,96,233,197,197,197,197,197,197,197,197,197,197,223,96,96,46,96,96,96,104,104,104,96,96,43,96
	!byte 100,100,100,100,100,100,100,100,96,100,100,100,96,100,98,220,224,174,232,232,232,232,232,232,232,232,220,104,44,96,96,104,102,224,224,224,102,44,96,96
	!byte 119,119,119,119,119,119,119,119,96,119,119,119,96,119,226,220,174,232,232,232,232,232,232,232,232,232,220,95,102,104,104,102,224,174,224,224,224,102,96,233
	!byte 96,96,96,96,104,104,104,104,104,104,104,96,233,224,224,223,104,104,123,68,119,32,119,68,104,104,233,223,95,224,224,224,224,224,171,224,224,105,233,224
	!byte 96,96,104,102,224,224,224,224,160,105,233,224,224,224,224,224,224,236,32,32,32,32,32,32,124,251,224,224,223,96,95,224,224,224,224,224,105,233,224,224
	!byte 96,104,224,224,224,224,224,105,233,224,224,224,160,239,239,228,224,32,32,32,32,32,32,32,32,103,160,224,224,224,223,95,160,160,105,96,233,224,224,224
	!byte 96,224,160,160,160,160,105,233,224,224,236,119,32,32,32,32,32,32,32,100,32,32,32,32,32,32,220,224,224,224,224,223,95,105,233,224,224,224,224,224
	!byte 96,224,224,224,105,233,224,224,224,236,32,32,32,32,32,32,32,103,223,172,208,97,32,32,32,108,224,224,224,224,224,224,224,223,95,160,160,160,160,224
	!byte 96,224,105,233,224,224,224,224,224,101,32,32,32,32,32,32,32,220,172,160,236,124,96,111,98,220,224,224,224,224,224,224,224,224,224,223,226,226,226,226
	!byte 96,105,233,224,224,224,224,224,224,101,32,32,32,32,32,32,32,220,160,127,108,254,160,239,232,95,224,224,224,224,224,224,224,224,172,224,224,224,224,105
	!byte 96,233,224,224,224,224,224,224,224,101,32,32,32,32,32,85,32,229,232,206,160,213,167,160,174,230,220,224,224,224,224,224,224,105,230,232,232,224,105,233
	!byte 233,224,224,224,224,224,239,239,160,252,123,32,32,32,32,74,75,206,160,160,213,254,202,160,160,102,225,224,224,224,224,224,105,108,98,98,98,98,98,224
	!byte 230,224,224,174,239,224,224,224,223,95,160,227,98,121,123,108,227,224,160,167,58,102,220,172,160,186,92,224,224,224,224,105,233,224,174,224,224,224,224,224
	!byte 230,224,232,95,224,205,224,224,224,96,96,233,206,105,92,230,230,224,224,160,223,220,102,212,160,160,92,224,224,224,224,96,224,224,224,224,224,174,224,224
	!byte 230,174,230,96,223,95,205,224,224,223,95,105,224,95,123,230,230,230,224,174,160,223,220,212,160,160,92,220,224,172,105,233,224,224,174,224,224,224,224,224
	!byte 230,232,95,230,223,104,224,224,224,224,223,95,105,162,160,123,230,253,205,224,232,126,220,161,160,160,92,172,230,230,96,230,230,230,230,230,224,224,224,224
	!byte 230,230,223,96,220,167,224,224,224,224,232,223,95,224,224,234,163,220,160,196,196,247,247,203,160,232,108,230,230,105,233,230,174,224,224,224,224,224,224,224
	!byte 225,230,220,92,96,105,174,224,223,224,174,233,106,224,224,224,208,196,196,192,239,239,239,239,232,105,254,230,230,96,230,224,224,224,224,224,174,224,224,224
	!byte 96,230,230,223,233,96,105,232,232,232,230,230,106,224,224,224,234,220,224,224,230,104,104,102,102,225,230,230,104,230,224,224,224,224,224,224,224,174,224,224
	!byte 96,95,174,220,233,96,96,95,105,105,105,105,233,224,160,236,233,160,224,160,174,230,160,102,102,244,230,186,224,224,224,224,174,224,224,174,224,224,224,224
	!byte 96,223,95,224,223,233,96,96,96,96,233,95,160,160,236,207,160,167,160,160,230,220,160,174,102,225,174,224,224,224,186,224,224,224,224,224,224,224,224,232
	!byte 96,174,223,95,224,223,233,96,96,96,96,233,95,160,220,160,187,160,160,174,230,245,174,102,102,225,224,224,224,224,224,174,224,224,186,224,174,224,232,58
	!byte 96,230,224,223,95,174,223,223,233,233,233,233,116,230,230,232,212,232,174,102,230,232,230,102,232,230,224,232,232,232,232,174,224,224,224,224,224,232,58,96
	!byte 96,34,230,232,223,95,174,197,196,196,196,197,96,230,230,230,230,102,230,232,230,230,230,230,230,230,220,232,96,96,96,230,232,232,232,232,232,44,96,96
	!byte 96,96,96,96,96,96,95,232,230,230,230,105,96,96,96,104,104,230,230,232,232,232,230,230,232,230,230,104,46,96,96,96,96,96,96,96,96,96,96,96

color_data:
; Color data
	!byte 12,0,12,4,4,4,4,4,4,4,4,11,4,4,4,15,15,3,15,3,3,14,3,14,14,14,6,0,0,6,0,0,5,3,3,3,0,0,11,12
	!byte 1,1,1,1,1,1,1,1,14,1,1,1,14,1,10,15,14,14,14,14,14,14,14,14,14,14,6,3,3,0,0,3,3,3,3,3,3,3,0,12
	!byte 7,7,7,7,7,1,7,1,14,1,1,1,14,1,4,14,6,6,6,6,6,6,6,6,6,6,6,3,3,3,3,3,3,3,3,3,3,3,5,13
	!byte 12,0,0,6,3,3,3,3,3,3,3,6,15,15,15,11,6,6,6,11,11,1,11,11,6,6,11,11,3,3,3,3,3,3,3,3,3,3,13,13
	!byte 12,0,3,3,3,3,3,3,3,3,12,12,12,12,12,11,11,11,9,8,8,8,8,8,11,11,11,12,12,12,3,3,3,3,3,3,3,13,13,5
	!byte 10,10,10,10,10,10,10,10,11,11,12,12,12,12,12,12,12,11,8,8,8,8,8,8,8,11,12,12,12,12,12,10,10,10,10,3,13,13,5,5
	!byte 12,4,4,4,4,4,4,11,12,15,12,12,11,8,8,8,11,8,8,8,8,8,8,8,8,8,11,12,12,12,12,12,4,4,13,13,13,5,5,5
	!byte 12,5,5,5,5,11,12,15,15,12,11,8,8,8,8,8,8,11,12,8,8,9,8,8,8,11,11,11,12,15,12,12,12,12,13,5,5,5,5,5
	!byte 12,5,5,11,11,15,15,15,12,11,8,8,8,8,8,8,9,9,8,8,9,9,8,9,9,11,11,12,12,15,15,12,12,12,12,12,5,5,5,5
	!byte 12,5,11,12,15,15,15,12,12,11,8,8,8,8,8,8,8,8,8,12,8,8,8,8,8,11,11,12,15,15,15,15,12,12,12,12,12,12,12,12
	!byte 3,11,12,15,15,15,12,12,11,11,8,8,8,8,8,2,8,9,8,8,8,8,8,8,8,9,11,12,15,15,15,12,12,11,11,11,11,11,11,13
	!byte 11,11,12,15,15,15,12,11,11,11,11,11,8,8,8,8,7,9,8,8,8,8,8,8,8,8,11,12,12,15,12,12,11,13,13,13,13,13,13,13
	!byte 11,11,12,12,12,15,15,15,15,11,11,11,11,11,11,9,9,8,8,8,12,8,8,8,8,8,8,11,12,12,12,11,13,13,13,13,13,13,13,13
	!byte 11,11,12,11,11,12,15,15,15,15,12,12,11,11,11,9,8,8,8,8,8,9,8,8,8,8,8,11,12,12,11,3,13,13,13,13,13,13,13,13
	!byte 11,11,11,11,10,12,15,15,15,15,13,12,11,11,5,9,8,8,8,8,8,8,9,8,8,8,8,11,11,11,11,5,5,5,5,5,5,5,5,13
	!byte 11,11,11,11,11,11,12,15,15,15,15,13,11,5,5,5,9,8,8,8,8,8,9,8,8,8,8,11,11,11,11,5,5,5,5,5,5,5,13,13
	!byte 11,11,12,11,11,11,11,12,15,15,15,11,5,5,5,5,8,8,8,8,8,8,8,8,8,8,11,11,11,11,5,5,5,5,5,5,13,13,13,13
	!byte 11,11,12,11,15,2,11,11,11,12,12,11,5,5,5,5,5,9,9,8,8,8,8,8,8,9,11,11,11,11,5,5,5,5,13,13,13,13,13,13
	!byte 5,11,12,12,9,15,2,11,11,11,11,11,5,5,5,5,5,9,8,8,8,9,9,9,9,5,5,11,5,5,5,13,13,13,13,13,13,13,13,13
	!byte 5,11,11,12,2,5,15,2,9,10,10,2,5,5,5,5,8,8,8,8,8,9,9,9,9,5,5,5,5,5,13,13,13,13,13,13,13,13,13,5
	!byte 5,5,11,11,12,2,11,11,11,11,9,5,5,5,5,8,8,8,8,8,8,9,8,9,9,5,5,5,5,13,13,13,13,13,13,13,13,13,5,5
	!byte 5,5,5,11,11,12,10,11,11,11,11,9,5,5,8,8,8,8,8,8,8,8,8,8,9,5,5,5,5,5,13,13,13,13,13,13,13,13,5,5
	!byte 5,5,5,5,11,11,12,2,2,10,2,9,11,5,9,8,8,8,8,8,5,5,5,9,5,5,5,5,5,5,5,5,5,13,13,13,13,5,5,12
	!byte 5,5,5,5,5,11,11,12,15,15,12,11,11,5,5,5,5,9,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,12
	!byte 5,5,5,5,5,5,11,11,11,11,11,11,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,8,8,8,8,8,5,5,12

text_colorcycle:
	!byte 0,0,0,0,0,0,0,0,0,0
	!byte 0,0,0,0,0,0,0,0,0,0
	!byte 0,0,0,0,0,0,0,0,0,0
	!byte 0,0,11,11,12,12,15,15,1,1,1,1,15,15,12,12,11,11,0,0

title_text: !scr "love in time of laser raptors"

waittime:
	!byte $40