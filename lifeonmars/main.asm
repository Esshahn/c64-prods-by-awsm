;
;
; life on mars - c64
; awsm 2018
;
;

!cpu 6502
!to "build/lifeonmars-c64.prg",cbm

;
; symbols
;

	SCRRAM = $0400
	COLRAM = $d800
	tmp_akku = $a6
	tmp_xreg = $a7
	tmp_yreg = $a8


;
; BASIC start line
;

	*=$801
	!byte $b,$08,$ef,$0,$9e,$32,$30,$36,$31,$0,$0,$0

;
; set border and background colors
;

	lda	#0
	sta	$d020
	sta	$d021
	ldx #0
	jsr clear

;
; show intro text
;

	ldx #0

show_title_text:

	lda title_text,x
	sta SCRRAM+12*40+10,x
	inx
	cpx #20
	bne show_title_text


	ldy #50
-
	jsr colwash
	dey
	bne -


;
; draw the chars into screenram
; and initialize all colors to black
;

	ldx	#0
	ldy	#250

screenram:

	; screen data
	lda	chars_data,x
	sta	SCRRAM,x
	lda	chars_data+250,x
	sta	SCRRAM+250,x
	lda	chars_data+500,x
	sta	SCRRAM+500,x
	lda	chars_data+750,x
	sta	SCRRAM+750,x

	; color data
	lda	#0
	sta	COLRAM,x
	sta	COLRAM+250,x	
	sta	COLRAM+500,x
	sta	COLRAM+750,x
	inx
	dey
	bne	screenram


;
; split line animation right to left
;

	ldx	#39
	ldy	#40


full_color_2
	; color data

	jsr wait

	lda color_data+1*40,x
	sta	COLRAM+1*40,x
	lda color_data+3*40,x
	sta	COLRAM+3*40,x	
	lda color_data+5*40,x
	sta	COLRAM+5*40,x
	lda color_data+7*40,x
	sta	COLRAM+7*40,x
	lda color_data+9*40,x
	sta	COLRAM+9*40,x
	lda color_data+11*40,x
	sta	COLRAM+11*40,x	
	lda color_data+13*40,x
	sta	COLRAM+13*40,x
	lda color_data+15*40,x
	sta	COLRAM+15*40,x	
	lda color_data+17*40,x
	sta	COLRAM+17*40,x
	lda color_data+19*40,x
	sta	COLRAM+19*40,x
	lda color_data+21*40,x
	sta	COLRAM+21*40,x
	lda color_data+23*40,x
	sta	COLRAM+23*40,x	

	dex
	dey
	bne	full_color_2

;
; split line animation left to right
;

	ldx	#0
	ldy	#40


full_color
	; color data

	jsr wait

	lda color_data,x
	sta	COLRAM+0*40,x
	lda color_data+2*40,x
	sta	COLRAM+2*40,x	
	lda color_data+4*40,x
	sta	COLRAM+4*40,x
	lda color_data+6*40,x
	sta	COLRAM+6*40,x
	lda color_data+8*40,x
	sta	COLRAM+8*40,x
	lda color_data+10*40,x
	sta	COLRAM+10*40,x	
	lda color_data+12*40,x
	sta	COLRAM+12*40,x
	lda color_data+14*40,x
	sta	COLRAM+14*40,x	
	lda color_data+16*40,x
	sta	COLRAM+16*40,x
	lda color_data+18*40,x
	sta	COLRAM+18*40,x
	lda color_data+20*40,x
	sta	COLRAM+20*40,x
	lda color_data+22*40,x
	sta	COLRAM+22*40,x	
	lda color_data+24*40,x
	sta	COLRAM+24*40,x	

	inx
	dey
	bne	full_color


-
	jmp -


;
; wait
;

wait:  
	stx tmp_xreg
	sty tmp_yreg
	sei
	lda #$fb
check:
	cmp $d012
	bne check
	ldy waittime
l0:
	ldx #$30
l1:
	dex
	cpx #$0          
	bne l1
	dey
	cpy #$0
	bne l0
	ldx tmp_xreg
	ldy tmp_yreg
  rts

;
; clear the screen
;

clear:
  lda #$20     ; #$20 is the spacebar Screen Code
	sta $0400,x  ; fill four areas with 256 spacebar characters
	sta $0500,x 
	sta $0600,x 
	sta $06e8,x
	lda #0
	sta $d800,x  
	sta $d900,x
	sta $da00,x
	sta $dae8,x
	inx           ; increment X
	bne clear     ; did X turn to zero yet?
	             ; if not, continue with the loop
	rts           ; return from this subroutine

;
; color washer routine
;

colwash:
	stx tmp_xreg
	lda text_colorcycle+49      ; load the current first color from table
	sta text_colorcycle+$00      ; store in in last position of table to reset the cycle
	ldx #50           ; init X with zero

cycle1:

	lda text_colorcycle-1,x      ; Start cycle by fetching next color in the table...
	sta text_colorcycle,x        ; ...and store it in the current active position.      
	sta COLRAM+12*40,x
	dex                ; increment X-Register
	bne cycle1         ; if no, continue
	jsr wait
	jsr wait
	jsr wait
	lda tmp_xreg
	rts

chars_data:
; Character data
	!byte 79,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,46,32,32,32,32,32,32,32,32,46,32,32,32,32,32,32,46,32,32,32,32,32,32,80
	!byte 79,46,32,32,46,100,233,232,232,232,123,32,32,32,32,32,32,46,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,46,79
	!byte 32,32,32,46,32,32,95,232,241,232,126,32,32,32,32,32,32,32,32,32,99,32,32,32,119,119,119,119,80,32,32,32,32,32,121,121,32,32,32,32
	!byte 32,32,32,32,32,32,32,32,226,32,32,32,32,102,160,160,160,160,160,160,223,32,32,254,174,32,32,32,106,32,32,32,108,160,215,174,231,92,32,32
	!byte 32,32,46,32,32,32,32,32,32,46,32,32,32,102,227,227,227,227,227,227,160,223,106,234,32,160,105,32,106,32,46,32,231,230,160,232,174,92,92,32
	!byte 32,32,32,32,32,32,32,32,32,32,32,32,32,102,227,227,227,227,227,227,104,104,106,220,32,232,223,32,122,32,32,103,174,220,229,160,215,92,92,32
	!byte 32,32,32,46,32,32,46,32,32,32,32,32,32,102,227,227,227,227,227,227,227,102,32,251,232,32,32,103,32,32,32,32,160,213,201,174,230,92,46,32
	!byte 32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,80,46,32,32,124,202,203,232,92,34,32,32
	!byte 46,32,32,32,32,111,121,111,82,70,68,104,32,32,32,32,32,32,32,98,247,98,32,32,32,32,32,32,106,32,32,32,32,32,119,34,32,32,46,32
	!byte 32,32,223,108,254,160,194,160,252,123,233,104,32,32,32,32,32,32,225,236,119,251,97,32,32,32,32,32,106,32,32,32,32,46,32,32,32,82,67,119
	!byte 104,104,160,220,160,160,194,160,160,160,220,108,32,32,32,32,32,32,244,101,32,103,231,32,32,32,32,32,32,32,46,82,70,69,68,104,68,32,32,32
	!byte 160,160,160,174,160,160,160,160,160,160,174,160,32,32,32,32,32,32,225,252,111,254,97,85,73,32,32,32,32,104,69,32,32,32,32,32,33,104,32,32
	!byte 160,118,160,227,205,160,160,160,206,197,160,117,32,32,32,32,32,32,32,226,239,226,32,74,75,32,32,32,32,100,104,98,104,104,104,233,160,223,104,104
	!byte 160,225,234,32,95,160,160,167,105,46,229,97,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,160,160,197,160,174,232,251,98,236,105,95
	!byte 232,225,160,32,32,95,160,105,32,32,160,92,32,32,32,32,32,32,32,85,68,73,32,32,32,32,32,32,32,220,232,232,160,160,88,206,163,205,232,232
	!byte 230,230,160,223,32,46,160,32,46,233,160,220,32,32,32,32,32,32,32,84,46,89,32,32,32,46,160,160,254,252,230,230,232,160,172,104,104,104,186,232
	!byte 104,104,225,160,223,104,160,104,233,167,97,232,32,32,32,32,32,32,32,84,102,89,32,32,32,46,160,103,172,160,73,230,232,232,232,230,162,230,230,230
	!byte 160,174,104,160,160,160,162,160,160,160,232,232,32,32,32,32,32,32,32,84,102,89,32,46,32,32,160,233,242,242,75,104,174,230,104,162,232,232,174,160
	!byte 160,160,174,124,160,160,239,160,160,126,104,104,32,32,32,46,32,32,32,74,104,75,32,32,32,32,108,206,189,189,250,232,160,160,174,162,160,160,160,160
	!byte 160,232,232,232,32,251,173,236,32,102,104,160,32,104,102,102,104,46,32,46,32,104,46,46,32,32,32,103,236,251,102,102,174,160,162,174,160,160,160,160
	!byte 160,174,230,230,92,32,32,32,104,104,46,160,160,104,102,232,232,92,104,160,46,104,104,46,46,160,230,108,97,254,102,102,102,162,232,232,160,160,160,160
	!byte 102,102,102,108,102,104,32,104,220,123,120,239,104,104,104,160,46,160,160,160,160,160,160,160,160,95,223,95,95,104,104,104,102,102,102,160,160,160,160,160
	!byte 102,32,108,160,162,102,102,102,160,160,123,32,120,160,160,160,160,160,160,160,160,160,160,105,32,32,95,32,34,172,105,104,39,104,102,102,104,104,247,232
	!byte 104,32,160,174,160,162,102,162,160,160,160,32,32,32,226,160,160,160,160,160,160,160,105,32,32,32,233,172,160,105,32,32,32,32,32,32,32,32,32,32
	!byte 76,104,230,194,232,232,232,232,160,161,232,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,81,18,5,3,32,160,206,206,105,32,122

color_data:
; Color data
	!byte 15,6,6,2,0,0,2,2,2,11,0,11,2,0,0,0,11,0,0,2,2,2,2,2,2,11,2,2,2,2,2,2,15,2,2,2,2,2,2,15
	!byte 0,11,13,13,11,9,10,12,12,12,12,2,2,2,2,2,2,15,2,2,2,2,2,2,2,2,2,2,2,2,12,12,12,12,12,12,12,12,11,0
	!byte 13,13,13,12,0,6,2,11,12,11,11,2,11,11,0,0,0,0,0,11,0,11,11,11,11,11,11,11,12,2,12,15,15,15,15,15,12,11,13,11
	!byte 13,13,13,6,0,0,11,6,11,11,11,11,11,11,15,15,15,15,15,15,12,11,11,6,6,6,6,11,12,2,15,15,15,15,12,12,11,11,11,0
	!byte 0,12,15,0,0,11,0,0,12,15,11,11,11,11,15,15,15,15,15,15,12,12,6,6,6,6,6,11,12,2,6,15,15,15,12,12,11,11,11,0
	!byte 0,0,11,0,0,0,0,0,0,15,11,11,0,11,15,15,15,15,15,15,15,11,6,6,6,2,2,11,12,2,0,15,15,12,12,11,11,11,11,11
	!byte 15,0,0,11,0,0,2,0,0,0,11,11,0,11,12,12,12,12,12,12,12,12,0,6,6,6,6,11,11,2,0,15,15,12,11,11,11,11,11,0
	!byte 2,11,11,11,11,11,11,0,0,0,0,0,0,11,0,0,0,0,6,6,6,6,11,11,0,0,0,0,12,11,0,0,12,11,11,11,11,11,0,0
	!byte 2,11,2,2,2,5,5,5,9,9,2,2,11,11,0,0,0,0,11,11,12,12,12,11,0,0,0,0,12,2,11,0,0,14,11,11,0,0,12,9
	!byte 11,11,5,5,5,5,5,5,5,5,5,9,0,11,0,0,0,15,11,11,12,12,12,0,0,0,0,0,11,2,0,12,11,2,11,11,10,2,2,2
	!byte 2,2,5,5,5,5,5,5,5,5,5,2,11,11,0,0,0,0,11,11,1,12,12,15,11,0,0,0,11,2,2,2,2,2,2,9,2,11,2,11
	!byte 2,2,5,5,5,5,5,5,5,5,5,2,11,11,0,0,0,0,11,11,11,11,11,11,11,0,0,0,11,2,2,2,2,11,11,11,7,9,8,11
	!byte 2,5,5,5,5,5,5,5,5,5,5,5,11,11,0,2,2,0,11,11,11,11,11,11,11,0,0,0,11,2,9,2,2,2,2,1,15,15,2,2
	!byte 2,5,5,5,5,5,5,5,5,11,5,5,11,2,2,2,2,2,0,11,11,11,3,0,0,0,0,0,11,2,2,2,2,2,2,12,7,12,2,2
	!byte 9,5,5,5,5,5,5,5,5,5,5,5,11,2,2,2,2,2,0,11,11,12,11,0,0,0,0,0,11,2,2,2,2,2,12,2,11,2,2,2
	!byte 9,9,5,5,11,11,5,5,6,5,5,2,11,2,2,2,2,2,0,11,11,12,3,0,0,11,0,0,15,12,2,2,2,2,2,2,2,2,2,2
	!byte 2,9,5,5,5,9,5,9,5,5,5,9,11,2,2,2,2,2,0,12,11,12,3,0,1,11,0,1,15,12,7,9,9,2,2,2,9,9,9,9
	!byte 9,9,9,5,5,5,5,5,5,5,9,9,11,2,2,2,2,0,0,12,11,11,3,11,11,11,0,1,7,7,7,9,9,9,9,9,9,9,9,9
	!byte 9,9,9,5,5,5,5,5,5,5,9,9,2,9,9,9,9,9,0,11,11,11,11,11,11,11,6,1,8,8,11,9,9,9,9,9,9,9,9,9
	!byte 9,9,9,9,5,5,5,5,5,9,9,0,11,9,9,9,9,9,11,9,11,9,9,9,11,11,14,1,12,11,9,9,9,9,9,9,9,9,9,9
	!byte 9,9,9,9,9,5,5,5,5,9,9,0,0,9,9,9,9,9,9,0,9,9,9,9,9,0,9,6,6,6,9,9,9,9,9,9,9,9,9,9
	!byte 9,9,9,5,5,5,5,5,5,5,0,0,9,9,9,0,9,0,0,0,0,0,0,0,0,0,0,0,0,9,9,9,9,9,9,9,9,9,9,9
	!byte 9,15,5,5,5,5,5,5,5,5,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,9,9,9,9,9,9,9,9,9
	!byte 9,13,5,5,5,5,5,5,5,5,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,2
	!byte 15,0,5,5,5,5,5,5,5,5,5,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,2,2,15,15,15,2,5,5,5,5,2,15

text_colorcycle:
	!byte 0,0,0,0,0,0,0,0,0,0
	!byte 0,0,0,0,0,0,0,0,0,0
	!byte 0,0,0,0,0,0,0,0,0,0
	!byte 0,0,11,11,12,12,15,15,1,1,1,1,15,15,12,12,11,11,0,0

title_text: !scr "... life on mars ..."

waittime:
	!byte $40